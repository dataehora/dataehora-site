<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Calend√°rio Anual Inteligente 2026 | dataehora.com.br</title>
    <meta name="description" content="Calend√°rio anual completo com feriados nacionais, fases da lua e semanas ISO. Exporta√ß√£o em PDF e visualiza√ß√£o personalizada.">
    <meta name="keywords" content="calend√°rio 2026, fases da lua, semanas ISO, calend√°rio anual, feriados, exportar PDF">
    <meta name="author" content="dataehora.com.br">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Calend√°rio Anual Inteligente 2026 | dataehora.com.br">
    <meta property="og:description" content="Calend√°rio anual completo com feriados nacionais, fases da lua e semanas ISO. Exporta√ß√£o em PDF e visualiza√ß√£o personalizada.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://dataehora.com.br/calendario/">
    <meta property="og:site_name" content="Data e Hora">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Calend√°rio Anual Inteligente 2026 | dataehora.com.br">
    <meta name="twitter:description" content="Calend√°rio anual completo com feriados nacionais, fases da lua e semanas ISO. Exporta√ß√£o em PDF e visualiza√ß√£o personalizada.">
    <meta name="twitter:site" content="@dataehora">
    <meta name="twitter:creator" content="@dataehora">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Calend√°rio Anual Inteligente",
      "url": "https://dataehora.com.br/calendario/",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "All",
      "featureList": "Calend√°rio Anual com Feriados, Fases da Lua, Semanas ISO, Exporta√ß√£o PDF"
    }
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4Y5H59FEQE"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-4Y5H59FEQE');
    </script>
    
    <!-- External Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- Theme Initialization - Must execute before page renders to prevent FOUC -->
    <script src="/js/theme.js"></script>
    
    <!-- Brazilian States Data -->
    <script src="/js/estados-brasil.js"></script>
    
    <style>
        :root {
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
            --accent: #2563eb;
            --accent-dark: #1e293b;
            --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
            --hr-color: rgba(100, 116, 139, 0.15);
            --weekend-bg: rgba(37, 99, 235, 0.04);
            --holiday-color: #ef4444;
            --font-scale: 1; 
        }

        [data-theme="dark"] {
            --bg-body: #020617;
            --bg-card: #0f172a;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --accent: #60a5fa;
            --accent-dark: #334155;
            --hr-color: rgba(255, 255, 255, 0.1);
            --weekend-bg: rgba(255, 255, 255, 0.03);
        }

        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }

        .container-central { width: 100%; max-width: 1300px; }

        /* --- BREADCRUMB PADRONIZADO --- */
        .nav-header { 
            display: flex; gap: 12px; margin: 10px 0 25px 0; align-items: center; font-size: 0.85rem;
        }
        .nav-link { text-decoration: none; font-weight: 700; color: var(--accent); }
        .nav-sep { color: var(--text-muted); font-size: 0.8rem; }

        /* --- CONTROLES --- */
        .controls-panel {
            background: var(--bg-card);
            padding: 25px; border-radius: 24px;
            box-shadow: var(--shadow);
            display: flex; flex-wrap: wrap; gap: 20px;
            margin-bottom: 30px; justify-content: center;
            align-items: flex-end; border: 1px solid var(--hr-color);
        }

        .control-group { display: flex; flex-direction: column; gap: 8px; }
        .control-group label { font-size: 0.65rem; font-weight: 800; text-transform: uppercase; color: var(--text-muted); letter-spacing: 0.8px; }
        
        select {
            padding: 10px 14px; border-radius: 12px; border: 2px solid var(--hr-color);
            background: var(--bg-body); color: var(--text-main); font-weight: 700; cursor: pointer;
            font-family: inherit; outline: none; transition: 0.2s;
        }
        select:focus { border-color: var(--accent); }

        .btn-pdf {
            background: var(--accent-dark); color: white; border: none; padding: 12px 24px;
            border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 8px; font-size: 0.9rem;
        }
        .btn-pdf:hover { transform: translateY(-2px); filter: brightness(1.3); }

        /* --- √ÅREA DE EXPORTA√á√ÉO (Sempre fundo branco para o PDF) --- */
        #export-area { 
            background-color: #ffffff; color: #0f172a;
            padding: 40px; width: 100%; border-radius: 20px;
            box-shadow: var(--shadow);
        }
        
        .logo-text { font-weight: 900; color: var(--accent); text-decoration: none; font-size: 1.1rem; margin-bottom: 5px; text-transform: lowercase; }
        .dynamic-title { text-align: center; margin: 10px 0 40px 0; font-size: 2.5rem; font-weight: 900; letter-spacing: -1.5px; }

        /* --- CALEND√ÅRIO --- */
        .calendar-container { display: grid; gap: 25px; width: 100%; }

        .month-card {
            background: #ffffff; border-radius: 16px; padding: 18px;
            border: 1px solid #e2e8f0; display: flex; flex-direction: column;
        }

        .month-name { text-align: center; font-weight: 900; color: #1e293b; margin-bottom: 15px; font-size: calc(1.1rem * var(--font-scale)); text-transform: uppercase; letter-spacing: 1px; }
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: calc(0.85rem * var(--font-scale)); }
        .calendar-grid.with-weeks { grid-template-columns: 32px repeat(7, 1fr); }
        
        .grid-bordered .day, .grid-bordered .day-name, .grid-bordered .week-num { border: 0.5px solid #edf2f7; }

        .day-name { font-weight: 800; color: #94a3b8; padding: 8px 0; font-size: calc(0.65rem * var(--font-scale)); }
        .week-num { font-size: calc(0.6rem * var(--font-scale)); color: #cbd5e1; display: flex; align-items: center; justify-content: center; background: #f8fafc; font-style: italic; font-weight: 600; }
        
        .day { padding: 10px 0; min-height: 40px; display: flex; align-items: center; justify-content: center; font-weight: 500; }
        .weekend { background-color: #f1f5f9; color: #2563eb; font-weight: 700; }
        .holiday { color: #ef4444 !important; font-weight: 900; }

        .month-footer { 
            margin-top: auto; padding-top: 12px; border-top: 1px solid #edf2f7; 
            display: flex; gap: 10px; min-height: 85px;
        }
        .footer-section { flex: 1; font-size: calc(0.65rem * var(--font-scale)); line-height: 1.4; color: #475569; }
        .footer-right { text-align: right; border-left: 1px solid #edf2f7; padding-left: 10px; }
        .footer-full { flex: 0 0 100%; }
        
        .info-title { font-weight: 800; font-size: calc(0.55rem * var(--font-scale)); text-transform: uppercase; color: #94a3b8; margin-bottom: 5px; display: block; }
        .moon-item { color: #1e293b; font-weight: 600; display: block; }
        .holiday-item { color: #ef4444; display: block; font-weight: 700; }

        footer {
            margin-top: 40px;
            padding: 30px 0;
            text-align: center;
        }

        .btn-settings {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            color: var(--text-main);
            padding: 12px 24px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 700;
            border: 1px solid var(--hr-color);
            transition: 0.2s;
            box-shadow: var(--shadow);
        }

        .btn-settings:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        @media print {
            .controls-panel, .nav-header { display: none !important; }
            body { background: white; padding: 0; }
            #export-area { padding: 0; box-shadow: none; }
        }
    </style>
</head>
<body>

<div class="container-central">
    <nav class="nav-header" aria-label="Navega√ß√£o estrutural">
        <a href="/" class="nav-link">dataehora.com.br</a>
        <span class="nav-sep">/</span>
        <span style="color: var(--text-muted); font-weight: 800;">Calend√°rio Anual</span>
    </nav>

    <div class="controls-panel">
        <div class="control-group">
            <label for="year-select">Ano</label>
            <select id="year-select" onchange="renderCalendar()">
                </select>
        </div>
        <div class="control-group">
            <label for="state-select">Estado</label>
            <select id="state-select" onchange="onStateChangeCalendar()">
                <option value="">Apenas Nacional</option>
            </select>
        </div>
        <div class="control-group">
            <label for="city-select">Munic√≠pio</label>
            <select id="city-select" onchange="renderCalendar()" disabled>
                <option value="">Selecione estado</option>
            </select>
        </div>
        <div class="control-group">
            <label for="grid-select">Visualiza√ß√£o</label>
            <select id="grid-select" onchange="renderCalendar()">
                <option value="3x4">3 colunas x 4 linhas</option>
                <option value="4x3">4 colunas x 3 linhas</option>
                <option value="2x6">2 colunas x 6 linhas</option>
            </select>
        </div>
        <div class="control-group">
            <label for="font-select">Tamanho Fonte</label>
            <select id="font-select" onchange="updateFontSize()">
                <option value="0.8">Pequena</option>
                <option value="1" selected>Normal</option>
                <option value="1.2">Grande</option>
            </select>
        </div>
        <div class="control-group">
            <label for="border-select">Estilo</label>
            <select id="border-select" onchange="renderCalendar()">
                <option value="no">Sem Bordas</option>
                <option value="yes">Com Bordas</option>
            </select>
        </div>
        <div class="control-group">
            <label for="week-toggle">Semana #</label>
            <select id="week-toggle" onchange="renderCalendar()">
                <option value="no">Ocultar</option>
                <option value="yes">Exibir</option>
            </select>
        </div>
        <div class="control-group">
            <label for="moon-toggle">Fases da Lua</label>
            <select id="moon-toggle" onchange="renderCalendar()">
                <option value="yes">Exibir</option>
                <option value="no">Ocultar</option>
            </select>
        </div>
        <button class="btn-pdf" onclick="exportToPDF()"> Salvar PDF </button>
    </div>

    <div id="export-area">
        <div class="logo-text">dataehora.com.br</div>
        <h1 class="dynamic-title" id="dynamic-year-title">Calend√°rio Anual</h1>
        <div class="calendar-container" id="calendar-wrapper"></div>
    </div>
</div>

<footer>
    <a href="/configuracoes/" class="btn-settings">‚öôÔ∏è Configura√ß√µes & Temas</a>
    <div style="margin-top: 30px; font-size: 0.85rem; color: var(--text-muted); text-align: center;">
        <p style="margin-bottom: 10px;">
            <a href="https://dataehora.com.br" style="color: var(--accent); text-decoration: none; font-weight: 700;">dataehora.com.br</a>
        </p>
        <p style="margin-bottom: 10px;">¬© 2026 Data e Hora. Todos os direitos reservados.</p>
        <p>
            Contato: <a href="mailto:contato@dataehora.com.br" style="color: var(--accent); text-decoration: none;">contato@dataehora.com.br</a>
        </p>
    </div>
</footer>

<script>
    const feriadosFixos = { "0-1":"Ano Novo","3-21":"Tiradentes","4-1":"Trabalho","8-7":"Independ√™ncia","9-12":"Nossa Sra. Aparecida","10-2":"Finados","10-15":"Proclama√ß√£o Rep√∫blica","10-20":"Consci√™ncia Negra","11-25":"Natal" };
    
    let stateHolidaysCalendar = {};
    let cityHolidaysCalendar = {};

    // Initialize state dropdown for calendar
    function initStateDropdownCalendar() {
        const stateSelect = document.getElementById('state-select');
        ESTADOS_BRASIL.forEach(estado => {
            const option = document.createElement('option');
            option.value = estado.uf;
            option.textContent = estado.nome;
            stateSelect.appendChild(option);
        });
    }

    // Handle state selection change on calendar
    async function onStateChangeCalendar() {
        const stateSelect = document.getElementById('state-select');
        const citySelect = document.getElementById('city-select');
        const selectedState = stateSelect.value;

        // Reset city dropdown
        citySelect.innerHTML = '<option value="">Carregando...</option>';
        citySelect.disabled = true;
        cityHolidaysCalendar = {};

        if (!selectedState) {
            citySelect.innerHTML = '<option value="">Selecione estado</option>';
            stateHolidaysCalendar = {};
            renderCalendar();
            return;
        }

        // Fetch municipalities for selected state
        const municipios = await getMunicipios(selectedState);
        citySelect.innerHTML = '<option value="">Apenas Estado</option>';
        municipios.forEach(mun => {
            const option = document.createElement('option');
            option.value = mun.codigo;
            option.textContent = mun.nome;
            citySelect.appendChild(option);
        });
        citySelect.disabled = false;

        // Note: State holidays would be fetched from API if available
        stateHolidaysCalendar = {};
        renderCalendar();
    }

    function getFeriadosMoveis(ano) {
        if(ano === 2025) return {"2-4":"Carnaval","3-18":"Sexta Santa","5-19":"Corpus Christi"};
        if(ano === 2026) return {"1-17":"Carnaval","3-3":"Sexta Santa","5-4":"Corpus Christi"};
        return {"1-9":"Carnaval","2-26":"Sexta Santa","4-27":"Corpus Christi"};
    }

    function setupYearSelect() {
        const select = document.getElementById('year-select');
        const currentYear = new Date().getFullYear();
        // MELHORIA: Pr√≥ximos 10 anos conforme solicitado
        for (let i = currentYear - 1; i <= currentYear + 10; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = i;
            if (i === currentYear) opt.selected = true;
            select.appendChild(opt);
        }
    }

    function getMoonData(y, m, d) {
        const lp = 2551442.8; 
        const now = new Date(y, m, d, 12, 0, 0);                        
        const ref = new Date(1970, 0, 7, 20, 35, 0);
        const phase = ((now.getTime() - ref.getTime()) / 1000) % lp;
        const days = phase / (24 * 3600);
        if (days < 1) return { n: "Nova", i: "‚óã" };
        if (days > 7.1 && days < 8.1) return { n: "Crescente", i: "‚óí" };
        if (days > 14.5 && days < 15.5) return { n: "Cheia", i: "‚óè" };
        if (days > 21.8 && days < 22.8) return { n: "Minguante", i: "‚óì" };
        return null;
    }

    function getWeekNumber(d) {
        d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
        d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
        return Math.ceil((((d - new Date(Date.UTC(d.getUTCFullYear(),0,1)))/86400000)+1)/7);
    }

    function updateFontSize() {
        const scale = document.getElementById('font-select').value;
        document.documentElement.style.setProperty('--font-scale', scale);
    }

    function renderCalendar() {
        const ano = parseInt(document.getElementById('year-select').value) || new Date().getFullYear();
        const gridType = document.getElementById('grid-select').value;
        const bordered = document.getElementById('border-select').value === 'yes';
        const showWeeks = document.getElementById('week-toggle').value === 'yes';
        const showMoons = document.getElementById('moon-toggle').value === 'yes';
        
        document.getElementById('dynamic-year-title').innerText = `Calend√°rio Anual ${ano}`;
        const wrapper = document.getElementById('calendar-wrapper');
        wrapper.style.gridTemplateColumns = `repeat(${gridType.split('x')[0]}, 1fr)`;
        wrapper.innerHTML = '';

        const fMoveis = getFeriadosMoveis(ano);
        const meses = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

        for (let m = 0; m < 12; m++) {
            let u = 0, fList = [], mList = [];
            const card = document.createElement('div');
            card.className = 'month-card';
            
            let gClass = `calendar-grid ${showWeeks ? 'with-weeks' : ''} ${bordered ? 'grid-bordered' : ''}`;
            let html = `<div class="month-name">${meses[m]}</div><div class="${gClass}">`;
            
            if(showWeeks) html += `<div class="day-name">#</div>`;
            ["S","T","Q","Q","S","S","D"].forEach(d => html += `<div class="day-name">${d}</div>`);

            const prim = new Date(ano, m, 1);
            let skip = prim.getDay() === 0 ? 6 : prim.getDay() - 1;
            const ult = new Date(ano, m + 1, 0).getDate();

            if(showWeeks) html += `<div class="week-num">${getWeekNumber(prim)}</div>`;
            for (let i = 0; i < skip; i++) html += `<div class="day"></div>`;

            for (let d = 1; d <= ult; d++) {
                const data = new Date(ano, m, d);
                const ds = data.getDay();
                const f = feriadosFixos[`${m}-${d}`] || fMoveis[`${m}-${d}`] || stateHolidaysCalendar[`${m}-${d}`] || cityHolidaysCalendar[`${m}-${d}`];
                const moon = getMoonData(ano, m, d);

                let cl = "day";
                if (ds === 0 || ds === 6) cl += " weekend";
                if (f) { cl += " holiday"; fList.push(`<span class="holiday-item">${d}: ${f}</span>`); }
                if (showMoons && moon) mList.push(`<span class="moon-item">${moon.i} ${d}: ${moon.n}</span>`);
                if (ds !== 0 && ds !== 6 && !f) u++;

                html += `<div class="${cl}">${d}</div>`;
                if(showWeeks && (skip + d) % 7 === 0 && d < ult) {
                    html += `<div class="week-num">${getWeekNumber(new Date(ano, m, d + 1))}</div>`;
                }
            }

            html += `</div><div class="month-footer">
                <div class="footer-section ${!showMoons ? 'footer-full' : ''}">
                    <span class="info-title">Eventos / Resumo</span>
                    ${fList.join('') || '--'}<br><strong>${u} dias √∫teis</strong>
                </div>
                ${showMoons ? `<div class="footer-section footer-right"><span class="info-title">Fases Lunares</span>${mList.join('') || '--'}</div>` : ''}
            </div>`;
            
            card.innerHTML = html;
            wrapper.appendChild(card);
        }
    }

    async function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const element = document.getElementById('export-area');
        const ano = document.getElementById('year-select').value;
        const btn = document.querySelector('.btn-pdf');
        
        btn.innerText = "‚è≥ Processando...";
        btn.disabled = true;

        const canvas = await html2canvas(element, { scale: 2, useCORS: true, backgroundColor: '#ffffff' });
        const imgData = canvas.toDataURL('image/png');

        const pdf = new jsPDF('p', 'mm', 'a3');
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = pdf.internal.pageSize.getHeight();
        const margin = 10;
        const maxWidth = pdfWidth - (margin * 2);
        const maxHeight = pdfHeight - (margin * 2);

        const ratio = canvas.width / canvas.height;
        let finalWidth = maxWidth;
        let finalHeight = finalWidth / ratio;

        if (finalHeight > maxHeight) {
            finalHeight = maxHeight;
            finalWidth = finalHeight * ratio;
        }

        pdf.addImage(imgData, 'PNG', (pdfWidth - finalWidth) / 2, margin, finalWidth, finalHeight);
        pdf.save(`Calendario-${ano}-dataehora.pdf`);
        
        btn.innerText = "üì• Exportar PDF (A3)";
        btn.disabled = false;
    }

    window.onload = () => {
        initStateDropdownCalendar();
        setupYearSelect();
        renderCalendar();
        updateFontSize();
    };
</script>
</body>
</html>