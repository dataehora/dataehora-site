<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Contagem Regressiva | Data e Hora</title>
    <style>
        :root { 
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; 
            --accent: #fb7185; --secondary: #94a3b8; --border: rgba(148, 163, 184, 0.1);
        }
        [data-theme="light"] {
            --bg: #f1f5f9; --card: #ffffff; --text: #0f172a; 
            --accent: #e11d48; --secondary: #64748b; --border: rgba(0, 0, 0, 0.05);
        }

        body { 
            background: var(--bg); color: var(--text); font-family: system-ui, sans-serif; 
            margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; 
            min-height: 100vh; transition: background 0.5s ease;
        }

        .container { width: 100%; max-width: 500px; margin-top: 40px; }
        
        .setup-box, .timer-box { 
            background: var(--card); padding: 30px; border-radius: 24px; 
            border: 1px solid var(--border); box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        h1 { font-size: 1.8rem; margin-bottom: 25px; color: var(--accent); text-align: center; }

        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        input { 
            width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border);
            background: var(--bg); color: var(--text); margin-bottom: 20px; box-sizing: border-box;
        }

        button { 
            width: 100%; padding: 15px; border-radius: 12px; border: none;
            background: var(--accent); color: white; font-weight: 700; cursor: pointer;
        }

        /* UI do Timer Ativo */
        .timer-display { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 25px 0; }
        .unit { background: var(--bg); padding: 15px 5px; border-radius: 12px; text-align: center; }
        .val { display: block; font-size: 1.8rem; font-weight: 800; }
        .lab { font-size: 0.6rem; text-transform: uppercase; color: var(--secondary); }

        .share-url { 
            background: rgba(148, 163, 184, 0.1); padding: 10px; border-radius: 8px;
            font-size: 0.8rem; word-break: break-all; margin-top: 20px; border: 1px dashed var(--secondary);
        }

        .hidden { display: none; }
    </style>
</head>
<body data-theme="dark">

    <div class="container">
        <div id="setup" class="setup-box">
            <h1>Criar Contagem</h1>
            <label>O que estamos esperando?</label>
            <input type="text" id="event-name" placeholder="Ex: Meu AniversÃ¡rio">
            
            <label>Data e Hora do Evento</label>
            <input type="datetime-local" id="event-date">
            
            <button onclick="generateLink()">ComeÃ§ar Contagem</button>
        </div>

        <div id="timer" class="timer-box hidden">
            <h1 id="display-name">---</h1>
            <div class="timer-display">
                <div class="unit"><span class="val" id="d">00</span><span class="lab">Dias</span></div>
                <div class="unit"><span class="val" id="h">00</span><span class="lab">Hrs</span></div>
                <div class="unit"><span class="val" id="m">00</span><span class="lab">Min</span></div>
                <div class="unit"><span class="val" id="s">00</span><span class="lab">Seg</span></div>
            </div>
            <button onclick="location.href='index.html'" style="background: var(--secondary); font-size: 0.8rem; padding: 10px;">Criar Outra</button>
            <div class="share-url" id="share-area">
                Link para compartilhar: <br><strong id="url-str"></strong>
            </div>
        </div>
    </div>

    <script>
        let countdownInterval;

        // Ao carregar, verifica se existem parÃ¢metros na URL
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            if(params.has('msg') && params.has('dt')) {
                startTimer(decodeURIComponent(params.get('msg')), params.get('dt'));
            }
        };

        function generateLink() {
            const msg = document.getElementById('event-name').value || "Evento Especial";
            const dt = document.getElementById('event-date').value;
            
            if(!dt) return alert("Selecione uma data!");

            const newUrl = window.location.origin + window.location.pathname + `?msg=${encodeURIComponent(msg)}&dt=${dt}`;
            window.history.pushState({}, '', newUrl);
            startTimer(msg, dt);
        }

        function startTimer(msg, dt) {
            document.getElementById('setup').classList.add('hidden');
            document.getElementById('timer').classList.remove('hidden');
            document.getElementById('display-name').textContent = msg;
            document.getElementById('url-str').textContent = window.location.href;

            const target = new Date(dt).getTime();

            const update = () => {
                const now = new Date().getTime();
                const diff = target - now;

                if (diff <= 0) {
                    document.getElementById('timer').innerHTML = `<h1>ðŸŽ‰ Chegou o momento!</h1><p>${msg}</p>`;
                    clearInterval(countdownInterval);
                    return;
                }

                document.getElementById('d').textContent = Math.floor(diff / 86400000).toString().padStart(2,'0');
                document.getElementById('h').textContent = Math.floor((diff % 86400000) / 3600000).toString().padStart(2,'0');
                document.getElementById('m').textContent = Math.floor((diff % 3600000) / 60000).toString().padStart(2,'0');
                document.getElementById('s').textContent = Math.floor((diff % 60000) / 1000).toString().padStart(2,'0');
            };

            update();
            countdownInterval = setInterval(update, 1000);
        }

        // SincronizaÃ§Ã£o de tema (mesma lÃ³gica dos outros)
        const savedTheme = localStorage.getItem('theme-pref-dataehora') || 'auto';
        document.body.setAttribute('data-theme', savedTheme === 'auto' ? (new Date().getHours() >= 6 && new Date().getHours() < 18 ? 'light' : 'dark') : savedTheme);
    </script>
</body>
</html>
